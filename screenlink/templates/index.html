<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScreenLink - Modern Screen Sharing</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="hero">
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                    <line x1="8" y1="21" x2="16" y2="21"></line>
                    <line x1="12" y1="17" x2="12" y2="21"></line>
                </svg>
                <h1>ScreenLink</h1>
            </div>
            <p class="tagline">Lightweight, browser-based screen sharing for tech support and collaboration</p>
        </header>

        <main class="main-content">
            <div class="card create-room">
                <h2>Host a Session</h2>
                <p>Start sharing your screen in seconds</p>
                <button id="createRoomBtn" class="btn btn-primary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="16"></line>
                        <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                    Create Room
                </button>
                <div id="roomCodeDisplay" class="room-code-display hidden">
                    <p>Your room code:</p>
                    <div class="code-box">
                        <span id="roomCode" class="code"></span>
                        <button id="copyCodeBtn" class="btn btn-icon" title="Copy to clipboard">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                    </div>
                    <p class="hint">Share this code with others to let them view your screen</p>
                    <a id="enterRoomLink" href="#" class="btn btn-secondary">Enter Room</a>
                </div>
            </div>

            <div class="divider">
                <span>or</span>
            </div>

            <div class="card join-room">
                <h2>Join a Session</h2>
                <p>Enter a room code to view someone's screen</p>
                <form id="joinRoomForm" class="join-form">
                    <div class="input-group">
                        <input 
                            type="text" 
                            id="roomCodeInput" 
                            class="code-input" 
                            placeholder="000000" 
                            maxlength="6" 
                            pattern="[0-9]{6}" 
                            required
                            autocomplete="off"
                        >
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                            <polyline points="10 17 15 12 10 7"></polyline>
                            <line x1="15" y1="12" x2="3" y2="12"></line>
                        </svg>
                        Join Room
                    </button>
                </form>
            </div>
        </main>

        <footer class="features">
            <div class="feature">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                <span>No downloads</span>
            </div>
            <div class="feature">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                    <line x1="8" y1="21" x2="16" y2="21"></line>
                    <line x1="12" y1="17" x2="12" y2="21"></line>
                </svg>
                <span>Peer-to-peer</span>
            </div>
            <div class="feature">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <span>Secure</span>
            </div>
        </footer>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Initialize Socket.IO
        const socket = io();
        
        // DOM Elements
        const createRoomBtn = document.getElementById('createRoomBtn');
        const roomCodeDisplay = document.getElementById('roomCodeDisplay');
        const roomCodeSpan = document.getElementById('roomCode');
        const copyCodeBtn = document.getElementById('copyCodeBtn');
        const enterRoomLink = document.getElementById('enterRoomLink');
        const joinRoomForm = document.getElementById('joinRoomForm');
        const roomCodeInput = document.getElementById('roomCodeInput');
        const toast = document.getElementById('toast');

        // Create room
        createRoomBtn.addEventListener('click', () => {
            socket.emit('create_room');
            createRoomBtn.disabled = true;
            createRoomBtn.textContent = 'Creating...';
        });

        // Room created handler
        socket.on('room-created', (data) => {
            const code = data.room_code;
            roomCodeSpan.textContent = code;
            enterRoomLink.href = `/room/${code}`;
            roomCodeDisplay.classList.remove('hidden');
            createRoomBtn.style.display = 'none';
        });

        // Copy room code
        copyCodeBtn.addEventListener('click', () => {
            const code = roomCodeSpan.textContent;
            navigator.clipboard.writeText(code).then(() => {
                showToast('Room code copied!');
            });
        });

        // Join room form
        joinRoomForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const code = roomCodeInput.value.trim();
            if (code.length === 6 && /^\d{6}$/.test(code)) {
                window.location.href = `/room/${code}`;
            } else {
                showToast('Please enter a valid 6-digit code');
            }
        });

        // Format room code input
        roomCodeInput.addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/\D/g, '').slice(0, 6);
        });

        // Toast notification
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Check for error in URL
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('error') === 'room_not_found') {
            showToast('Room not found. Please check the code and try again.');
        }
    </script>
</body>
</html>
